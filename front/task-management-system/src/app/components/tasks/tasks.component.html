<title>Tasks</title>
<div class="container-fluid pt-2" style="padding-bottom: 100px;">
    <div class="row justify-content-center">
        <div class="col-10 head">
            <h1 class="mat-display-1 mb-0">Tasks</h1>
            <div class="task-creating-button">
                <app-task-create ></app-task-create>
            </div>
        </div>
    </div>
    <div class="filters-content mt-2">
        <div class="row justify-content-center">
            <div class="col-10">
                <form [formGroup]="filtersForm">
                    <div class="row">
                        <div class="dropdown col-8 p-0">
                            <button class="menu-toggle filters-menu-toggle" 
                                (click)="toggleFiltersMenu()"
                                [ngClass]="{ 'active-btn': displayFiltersMenu }">
                                Filters
                                <span class="badge badge-active" 
                                    *ngIf="filterApplied && !displayFiltersMenu">
                                    {{ appliedFilterCount }}</span>
                            </button>
                            <div class="col-5 ml-2 dropdown-menu dropdown-menu-left filters-menu-content"
                                aria-labelledby="filters-menu"
                                *ngIf="displayFiltersMenu">
                                <div class="row justify-content-center pt-3">
                                    <button type="button" 
                                        class="close filters-menu-close"
                                        (click)="closeFiltersMenu()">
                                        <span>&times;</span>
                                    </button>
                                    <mat-form-field appearance="outline" style="width: 75%;">
                                        <mat-label>Status</mat-label>
                                        <mat-select (selectionChange)="onFilterApply()" 
                                            multiple
                                            formControlName="statusIds">
                                          <mat-option *ngFor="let status of statuses" [value]="status.id">
                                              {{ status.name }}
                                          </mat-option>
                                        </mat-select>
                                    </mat-form-field>
                                    <mat-form-field appearance="outline" style="width: 75%;">
                                        <mat-label>Due date until</mat-label>
                                        <input matInput [matDatepicker]="picker"
                                            (dateInput)="onFilterApply()"
                                            formControlName="deadline">
                                        <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
                                        <mat-datepicker #picker></mat-datepicker>
                                    </mat-form-field>
                                    <mat-form-field appearance="outline" style="width: 75%;" *ngIf="!isExecutor">
                                        <mat-label>Executor</mat-label>
                                        <mat-select (selectionChange)="onFilterApply()" formControlName="executorId">
                                            <mat-option [value]="null">Any</mat-option>
                                            <mat-option *ngFor="let executor of executors" [value]="executor.id">
                                                {{ executor.fullName }}
                                            </mat-option>
                                        </mat-select>
                                    </mat-form-field>
                                </div>
                            </div>
                        </div>
                        <input type="text" 
                            class="form-control search-input ml-auto" 
                            formControlName="title">
                        <button type="button"
                            class="btn btn-success search-btn" 
                            (click)="onFilterApply()">Search</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <div class="task-content">
        <div class="row justify-content-center">
            <div class="task col-10 mt-3 p-0" *ngFor="let task of pageTasks">
                <div class="task-header px-3 py-2">
                    <p class="mb-1 fs-18">{{ task.title }}</p>
                    <p class="mb-0 fs-17">{{ task.executorName }}</p>
                    <div class="context-menu-content" *ngIf="!isExecutor">
                        <button class="menu-toggle context-menu-toggle" 
                            id="context-menu-dropdown" 
                            data-toggle="dropdown" 
                            aria-haspopup="true"
                            aria-expanded="false">
                        </button>
                        <div class="dropdown-menu dropdown-menu-right mt-1"
                            aria-labelledby="context-menu-dropdown">
                            <button class="dropdown-item" (click)="openEditTaskDialogue(task.id)">Edit</button>
                            <button class="dropdown-item" (click)="deleteTask(task.id)">Delete</button>
                        </div>
                    </div>
                </div>
                <div class="task-body px-3 py-2">
                    <p class="fs-17">{{ task.description }}</p>
                    <p class="fs-17"><b>Due date: </b>{{ task.deadline }}</p>
                </div>
            </div>
        </div>
    </div>
    <app-pagination class="pt-3" 
        [collectionSize]="taskCount"
        [pageSize]="taskPage.pageSize"
        [pageNumber]="taskPage.pageNumber"
        (pageSizeChange)="onPageSizeChange($event)"
        (pageChange)="onPageChange($event)"
        ></app-pagination>
</div>
